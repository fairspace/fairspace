@prefix fs: <http://fairspace.io/ontology#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix schema: <http://www.schema.org/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix osiris: <http://osiris.fairspace.io/ontology#> .
@prefix icdo3: <http://icdo3.fairspace.io/ontology#> .
@prefix fhir: <http://hl7.org/fhir/STU3/> .

########################
###   User Shapes    ###
########################

## Augmented system class shapes
fs:FileShape sh:property
    <associatedAnalysisShape> .

fs:CollectionShape sh:property
    <aboutPersonShape>,
    <aboutMaterialShape>,
    <partOfProjectShape> .


## User class Shapes

<PersonShape> a fs:ClassShape ;
    sh:closed false ;
    sh:description "A person that is subject of research." ;
    sh:name "Person" ;
    sh:targetClass foaf:Person ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    
    sh:property
        <AdministrativeGenderShape>,
        <ageOfDeathShape>,
        <patientIdentifierShape>,
        <hasEventShape>,
        <gaveConsentShape>,
        fs:labelShape,
        fs:commentShape .

<PersonConsentShape> a fs:ClassShape ;
    sh:closed false ; 
    sh:description "A research consent given by person." ;
    sh:name "Person Consent" ;
    sh:targetClass <PersonConsent> ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    
    sh:property
        <isProjectConsentShape>,
        <authorizesShape>,
        <isConsentOfShape>,
        fs:labelShape,
        fs:commentShape .

<ResearchProjectShape> a fs:ClassShape ;
    sh:closed false ; 
    sh:description "A research project." ;
    sh:name "Research Project" ;
    sh:targetClass <ResearchProject> ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    
    sh:property
        <projectCodeShape>,
        <investigationNatureShape>,
        <projectManagerShape>,
        <hasCollectionShape>,
        <hasPersonConsentShape>,
        fs:labelShape,
        fs:commentShape .

<TumorPathologyEventShape> a fs:ClassShape ;
    sh:closed false ; 
    sh:description "Description for osiris:TumorPathologyEvent" ;
    sh:name "Tumor Pathology Event" ;
    sh:targetClass osiris:TumorPathologyEvent ; 
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    
    sh:property
        <EventTypeShape>,
        <EventStartDateShape>,
        <EventEndDateShape>,
        <diagnosisDateShape>,
        <isAnalysedByShape>,
        <eventSubjectShape>,
        <isLinkedToShape>,
        fs:labelShape,
        fs:commentShape .

<BiologicalSampleShape> a fs:ClassShape ;
    sh:closed false ; 
    sh:description "Description for osiris:BiologicalSample" ;
    sh:name "Biological Sample" ;
    sh:targetClass osiris:BiologicalSample ; 
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    
    sh:property
        <collectDateShape>,
        <tumorCellularityShape>,
        <isAuthorizedByShape>,
        <isParentOfShape>,
        <isChildOfShape>,
        fs:labelShape,
        fs:commentShape .

<AnalysisShape> a fs:ClassShape ;
    sh:closed false ; 
    sh:description "Description for <Analysis" ;
    sh:name "Analysis" ;
    sh:targetClass <Analysis> ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    
    sh:property
        <analysisCodeShape>,
        <analyticPipelineCodeShape>,
        <numberOfBreakPointsShape>,
        <associatedFilesShape>,
        fs:labelShape,
        fs:commentShape .

<WidgetMaster> a fs:Class .
<WidgetMasterShape> a fs:ClassShape ;
    sh:closed false ; 
    sh:description "A widget is an element of a graphical user interface (GUI) that displays information or provides a specific way for a user to interact with the operating system or an application." ;
    sh:name "Master of widgets" ;
    sh:targetClass <WidgetMaster> ;
    sh:ignoredProperties ( rdf:type owl:sameAs ) ;
    sh:property
        <relatesToWidgetShape>,
        <dateWidgetShape>,
        <dateTimeWidgetShape>,
        <multiLineStringWidgetShape>,
        <integerLongWidgetShape>,
        <integerWidgetShape>,
        <booleanWidgetShape>,
        <booleanX2WidgetShape>,
        <fixedDropdownWidgetShape>,
        <resourceWidgetShape>,
        <websiteWidgetShape>,
        fs:labelShape,
        fs:commentShape .

## User property shapes

<dateWidget> a rdf:Property .
<dateWidgetShape> a fs:DatatypePropertyShape ;
    sh:name "A single date" ;
    sh:description "A single date." ;
    sh:datatype xsd:date ;
    sh:maxCount 1 ;
    sh:path <dateWidget> .

<dateTimeWidget> a rdf:Property .
<dateTimeWidgetShape> a fs:DatatypePropertyShape ;
    sh:name "Date and times" ;
    sh:description "A bunch of date and times." ;
    sh:datatype xsd:dateTime ;
    sh:path <dateTimeWidget> .

<multiLineStringWidget> a rdf:Property .
<multiLineStringWidgetShape> a fs:DatatypePropertyShape ;
    sh:name "Multi line string" ;
    sh:description "Can do newlines, but max length of 500." ;
    sh:datatype xsd:string ;
    sh:maxLength 500 ;
    sh:path <multiLineStringWidget> .

<integerLongWidget> a rdf:Property .
<integerLongWidgetShape> a fs:DatatypePropertyShape ;
    sh:name "Integer (long)" ;
    sh:description "A single integer (long)." ;
    sh:datatype xsd:long ;
    sh:maxCount 1 ;
    sh:path <integerLongWidget> .

<integerWidget> a rdf:Property .
<integerWidgetShape> a fs:DatatypePropertyShape ;
    sh:name "Integer" ;
    sh:description "A single integer." ;
    sh:datatype xsd:integer ;
    sh:maxCount 1 ;
    sh:path <integerWidget> .

<booleanWidget> a rdf:Property .
<booleanWidgetShape> a fs:DatatypePropertyShape ;
    sh:name "Boolean" ;
    sh:description "On or off single." ;
    sh:datatype xsd:boolean ;
    sh:maxCount 1 ;
    sh:path <booleanWidget> .

<booleanX2Widget> a rdf:Property .
<booleanX2WidgetShape> a fs:DatatypePropertyShape ;
    sh:name "Boolean X4" ;
    sh:description "On or off (max 2) times. Can only store unique values though." ;
    sh:datatype xsd:boolean ;
    sh:maxCount 2 ;
    sh:path <booleanX2Widget> .

<fixedDropdownWidget> a rdf:Property .
<fixedDropdownWidgetShape> a fs:ControlledVocabularyPropertyShape ;
    sh:name "Fixed set of values (pick 2)" ;
    sh:description "A set of 2 values from a fixed list." ;
    sh:in ( "E" "A" "D" "G" "B" "E" ) ; 
    sh:maxCount 2 ;
    sh:path <fixedDropdownWidget> .

<resourceWidget> a rdf:Property .
<resourceWidgetShape> a fs:ExternalIRIPropertyShape ;
    sh:name "Resource" ;
    sh:description "Some URL" ;
    sh:nodeKind sh:IRI ;
    sh:maxCount 5 ;
    sh:path <resourceWidget> .

<websiteWidget> a rdf:Property .
<websiteWidgetShape> a fs:ExternalIRIPropertyShape ;
    sh:name "Website" ;
    sh:description "A URL for another website" ;
    sh:nodeKind sh:IRI ;
    fs:externalLink true ;
    sh:maxCount 5 ;
    sh:path <websiteWidget> .

<projectCodeShape> a fs:DatatypePropertyShape ;
    sh:name "Project Code" ;
    sh:description "Specific project code." ;
    sh:datatype xsd:token ;
    sh:maxCount 1 ;
    sh:path <projectCode> .
     
<investigationNatureShape> a fs:ControlledVocabularyPropertyShape ;
    sh:name "Investigation Nature" ;
    sh:description "choose between: basic research, biomedical research, clinical trial, medical diagnosis" ;
    sh:in (
      "basic research"
      "biomedical research"
      "clinical trial"
      "medical diagnosis"
      ) ;
    sh:path <investigationNature> .
     
<projectManagerShape> a fs:DatatypePropertyShape ;
    sh:name "Project Manager" ;
    sh:description "Project manager" ;
    sh:datatype xsd:token ;
    sh:path <projectManager> .
     
<AdministrativeGenderShape> a fs:ControlledVocabularyPropertyShape ;
    sh:name "Gender" ;
    sh:description "The gender of the patient" ;
    sh:in (
      "Male"
      "Female"
      "Unknown"
      "Other"
      ) ;
    sh:maxCount 1 ;
    sh:path fhir:AdministrativeGender . 
     
<ageOfDeathShape> a fs:DatatypePropertyShape ;
    sh:name "Age of death" ;
    sh:description "The age at which this person has died" ;
    sh:datatype xsd:date ;
    sh:maxCount 1 ;
    sh:path <ageOfDeath> .
     
<patientIdentifierShape> a fs:DatatypePropertyShape ;
    sh:name "Patient Identifier" ;
    sh:description "The identifier of the patient" ;
    sh:datatype xsd:token ;
    sh:maxCount 1 ;
    sh:path <patientIdentifier> .
     
<EventTypeShape> a fs:ControlledVocabularyPropertyShape ;
    sh:name "Neoplasm Event" ;
    sh:description "The type of tumor event." ;
    sh:in (
      "primary tumor"
      "local relapse"
      "metastatic relapse"
    ) ;
    sh:maxCount 1 ;
    sh:path osiris:EventType . 
     
<EventStartDateShape> a fs:DatatypePropertyShape ;
    sh:name "Neoplasm Event Start Date" ;
    sh:description "The start date of the tumor event" ;
    sh:datatype xsd:date ;
    sh:maxCount 1 ;
    sh:path osiris:EventStartDate . 
     
<EventEndDateShape> a fs:DatatypePropertyShape ;
    sh:name "Neoplasm Event End Date" ;
    sh:description "The end date of the tumor event" ;
    sh:datatype xsd:date ;
    sh:maxCount 1 ;
    sh:path osiris:EventEndDate . 
     
<diagnosisDateShape> a fs:DatatypePropertyShape ;
    sh:name "Neoplasm diagnosis date" ;
    sh:description "The date of tumor diagnosis" ;
    sh:datatype xsd:date ;
    sh:maxCount 1 ;
    sh:path <diagnosisDate> .
     
<collectDateShape> a fs:DatatypePropertyShape ;
    sh:name "Collect Date" ;
    sh:description "The collect date of the biological sample" ;
    sh:datatype xsd:date ;
    sh:maxCount 1 ;
    sh:path <collectDate> .

<tumorCellularityShape> a fs:DatatypePropertyShape ;
    sh:name "Tumor Cellularity" ;
    sh:description "The percentage of tumor cells in the biological sample (pathological measure)" ;
    sh:datatype xsd:integer ;
    sh:maxCount 1 ;
    sh:path <tumorCellularity> .
     
<analysisCodeShape> a fs:DatatypePropertyShape ;
    sh:name "Analysis code" ;
    sh:description "The analysis run identifier" ;
    sh:datatype xsd:token ;
    sh:maxCount 1 ;
    sh:path <analysisCode> .
     
<analyticPipelineCodeShape> a fs:DatatypePropertyShape ;
    sh:name "Analytic pipeline code" ;
    sh:description "Identifier of the pipeline used into the analysis (unique in the center)" ;
    sh:datatype xsd:token ;
    sh:maxCount 1 ;
    sh:path <analyticPipelineCode> .
     
<numberOfBreakPointsShape> a fs:DatatypePropertyShape ;
    sh:name "Number of break points" ;
    sh:description "Calculated number of break points in genomic profile" ;
    sh:datatype xsd:integer ;
    sh:maxCount 1 ;
    sh:path <numberOfBreakPoints> .

## User relation shapes

<relatesToWidget> a rdf:Property .
<relatesToWidgetShape> a fs:RelationShape ;
    sh:name "Relates to widget master" ;
    sh:description "Relates to other widget masters" ;
    sh:class <WidgetMaster> ;
    fs:inverseRelation <relatesToWidgetShape> ;
    sh:path <relatesToWidget> .

<derivesFromShape> a fs:RelationShape ;
    sh:name "Derives from" ;
    sh:description "Person that provided this sample." ;
    sh:class foaf:Person ; 
    sh:maxCount 1 ;
    fs:inverseRelation <providesMaterialShape> ;
    sh:path <derivesFrom> .

<providesMaterialShape> a fs:RelationShape ;
    sh:name "Provides material" ;
    sh:description "Samples provided by this person" ;
    sh:class osiris:BiologicalSample ; 
    fs:inverseRelation <derivesFromShape> ;
    sh:path <providesMaterial> .

<isConsentOfShape> a fs:RelationShape ;
    sh:name "Is consent of" ;
    sh:description "" ;
    sh:class foaf:Person ; 
    sh:maxCount 1 ;
    fs:inverseRelation <gaveConsentShape> ;
    sh:path <isConsentOf> .

<gaveConsentShape> a fs:RelationShape ;
    sh:name "Gave consent" ;
    sh:description "" ;
    sh:class <PersonConsent> ;
    fs:inverseRelation <isConsentOfShape> ;
    sh:path <gaveConsent> .

<hasCollectionShape> a fs:RelationShape ;
    sh:name "Has associated collections" ; 
    sh:description "Collections that are related to this project." ;
    sh:class fs:Collection ; 
    fs:inverseRelation <partOfProjectShape> ;
    sh:path <hasCollection> .

<partOfProjectShape> a fs:RelationShape ;
    sh:name "Part of project" ;
    sh:description "" ;
    sh:class <ResearchProject> ;
    sh:maxCount 1 ;
    fs:inverseRelation <hasCollectionShape> ;
    sh:path <partOfProject> .

<aboutPersonShape> a fs:RelationShape ;
    sh:name "Is about person" ;
    sh:description "Persons that are featured in this collection." ;
    sh:class foaf:Person ;
    fs:inverseRelation <hasDataShape> ;
    sh:path <aboutPerson> .

<hasDataShape> a fs:RelationShape ;
    sh:name "Has data in collection" ;
    sh:description "Collections that contain data for this person." ;
    sh:class fs:Collection ;
    fs:inverseRelation <aboutPersonShape> ;
    sh:path <hasData> .

<aboutMaterialShape> a fs:RelationShape ;
    sh:name "Is about biological sample." ;
    sh:description "Materials that are featured in this collection." ;
    sh:class osiris:BiologicalSample ; 
    sh:path <aboutMaterial> .

<hasDataSShape> a fs:RelationShape ;
    sh:name "Has data in collection" ;
    sh:description "Collections that contain data for this sample." ;
    sh:class fs:Collection ;
    fs:inverseRelation <aboutMaterialShape> ;
    sh:path <hasDataS> .

<isProjectConsentShape> a fs:RelationShape ;
    sh:name "Consent for specific project" ;
    sh:description "" ;
    sh:class <ResearchProject> ;
    fs:inverseRelation <hasPersonConsentShape> ;
    sh:path <isProjectConsent> .

<hasPersonConsentShape> a fs:RelationShape ;
    sh:name "Person consent" ;
    sh:description "" ;
    sh:class <PersonConsent> ;
    fs:inverseRelation <isProjectConsentShape> ;
    sh:path <hasPersonConsent> .

<isAnalysedByShape> a fs:RelationShape ;
    sh:name "Event is analysed by" ;
    sh:description "Analyses associated with this tumor pathology event" ;
    sh:class <Analysis> ;
    fs:inverseRelation <analysisOfEventShape> ;
    sh:path <isAnalysedBy> .

<analysisOfEventShape> a fs:RelationShape ;
    sh:name "Analysis of tumor event" ;
    sh:description "Event associated with this analysis" ;
    sh:class osiris:TumorPathologyEvent ; 
    sh:maxCount 1 ;
    fs:inverseRelation <isAnalysedByShape> ;
    sh:path <analysisOfEvent> .

<authorizesShape> a fs:RelationShape ;
    sh:name "Consent authorizes" ;
    sh:description "The samples that is authorized with this consent" ;
    sh:class osiris:BiologicalSample ; 
    fs:inverseRelation <isAuthorizedByShape> ;
    sh:path <authorizes> .

<isAuthorizedByShape> a fs:RelationShape ;
    sh:name "Sample is authorized by" ;
    sh:description "The relevent consent" ;
    sh:class <PersonConsent> ;
    sh:maxCount 1 ;
    fs:inverseRelation <authorizesShape> ;
    sh:path <isAuthorizedBy> .

<hasEventShape> a fs:RelationShape ;
    sh:name "Event" ;
    sh:description "Tumor pathology events for this patient" ;
    sh:class osiris:TumorPathologyEvent ; 
    fs:inverseRelation <eventSubjectShape> ;
    sh:path <hasEvent> .

<eventSubjectShape> a fs:RelationShape ;
    sh:name "Event subject" ;
    sh:description "The patient associated with this event" ;
    sh:class foaf:Person ; 
    sh:maxCount 1 ;
    fs:inverseRelation <hasEventShape> ;
    sh:path <eventSubject> .

<associatedAnalysisShape> a fs:RelationShape ;
    sh:name "Analysed by" ;
    sh:description "The files associated to the analysis" ;
    sh:class <Analysis> ;
    sh:maxCount 1 ;
    fs:inverseRelation <associatedFilesShape> ;
    sh:path <associatedAnalysis> .

<associatedFilesShape> a fs:RelationShape ;
    sh:name "Analysis files" ;
    sh:description "The analysis linked to the files" ;
    sh:class fs:File ; 
    fs:inverseRelation <associatedAnalysisShape> ;
    sh:path <associatedFiles> .

<isParentOfShape> a fs:RelationShape ;
    sh:name "Sample has children" ;
    sh:description "The biological sample has child samples extracted (ex : tissue DNA extraction)" ;
    sh:class osiris:BiologicalSample ; 
    fs:inverseRelation <isChildOfShape> ;
    sh:path <isParentOf> .

<isChildOfShape> a fs:RelationShape ;
    sh:name "Sample is child sample of" ;
    sh:description "The biological sample has been extracted from this parent sample" ;
    sh:class osiris:BiologicalSample ; 
    fs:inverseRelation <isParentOfShape> ;
    sh:path <isChildOf> .

<isLinkedToShape> a fs:RelationShape ;
    sh:name "Event parentage" ;
    sh:description "The tumor events could be linked to others as a chain. For example, a primary tumor event could be linked to a local relapse and then a metastatic relapse." ;
    sh:class osiris:TumorPathologyEvent ; 
    fs:inverseRelation <isLinkedToShape> ;
    sh:path <isLinkedTo> .


########################
###   User Classes   ###
########################

foaf:Person a fs:Class .
<PersonConsent> a fs:Class .
<ResearchProject> a fs:Class .
osiris:TumorPathologyEvent a fs:Class .
osiris:BiologicalSample a fs:Class .
<Analysis> a fs:Class .

########################
### User Properties  ###
########################

rdfs:label a rdf:Property .
rdfs:comment a rdf:Property .
<projectCode> a rdf:Property .
<investigationNature>  a rdf:Property .
<projectManager> a rdf:Property .
fhir:AdministrativeGender a rdf:Property .
<ageOfDeath> a rdf:Property .
<patientIdentifier> a rdf:Property .
osiris:EventType a rdf:Property .
osiris:EventStartDate a rdf:Property .
osiris:EventEndDate a rdf:Property .
<diagnosisDate> a rdf:Property .
icdo3:Topography a rdf:Property .
icdo3:Morphology a rdf:Property .
osiris:Laterality a rdf:Property .
<collectDate> a rdf:Property .
osiris:SampleOrigin a rdf:Property .
osiris:StorageTemperature a rdf:Property .
<tumorCellularity> a rdf:Property .
<analysisCode> a rdf:Property .
osiris:AnalysisType a rdf:Property .
osiris:AnalysisDate a rdf:Property .
osiris:TechnicalProtocol a rdf:Property .
osiris:PlatformName a rdf:Property .
<analyticPipelineCode> a rdf:Property .
<AlgorithmicCellularity> a rdf:Property .
osiris:AlgorithmicPloidy a rdf:Property .
<numberOfBreakPoints> a rdf:Property .

## User relations

<hasData> a rdf:Property .
<aboutPerson> a rdf:Property .
<aboutMaterial> a rdf:Property .

<derivesFrom> a rdf:Property ;
    owl:inverseOf <providesMaterial> .

<providesMaterial> a rdf:Property ;
    owl:inverseOf <derivesFrom> .

<isConsentOf> a rdf:Property ;
    owl:inverseOf <gaveConsent> .

<gaveConsent> a rdf:Property ;
    owl:inverseOf <isConsentOf> .

<hasCollection> a rdf:Property ;
    owl:inverseOf <partOfProject> .

<partOfProject> a rdf:Property ;
    owl:inverseOf <hasCollection> .

<isProjectConsent> a rdf:Property ;
    owl:inverseOf <hasPersonConsent> .

<hasPersonConsent> a rdf:Property ;
    owl:inverseOf <isProjectConsent> .

<isAnalysedBy> a rdf:Property ;
    owl:inverseOf <analysisOfEvent> .

<analysisOfEvent> a rdf:Property ;
    owl:inverseOf <isAnalysedBy> .

<authorizes> a rdf:Property ;
    owl:inverseOf <isAuthorizedBy> .

<isAuthorizedBy> a rdf:Property ;
    owl:inverseOf <authorizes> .

<hasEvent> a rdf:Property ;
    owl:inverseOf <eventSubject> .

<eventSubject> a rdf:Property ;
    owl:inverseOf <hasEvent> .

<associatedAnalysis> a rdf:Property ;
    owl:inverseOf <associatedFiles> .

<associatedFiles> a rdf:Property ;
    owl:inverseOf <associatedAnalysis> .

<isParentOf> a rdf:Property ;
    owl:inverseOf <isChildOf> .

<isChildOf> a rdf:Property ;
    owl:inverseOf <isParentOf> .

<isLinkedTo> a rdf:Property ;
    owl:inverseOf <isLinkedTo> .
