# Application's port
port: 8080
publicUrl: http://localhost:8080
elasticsearchUrl: http://localhost:9200
jena:
  # Base IRI for all metadata entities
  metadataBaseIRI: "http://localhost/iri/"
  # Jena's TDB2 database path
  datasetPath: "data/db"
  storeParams:
    tdb.file_mode: "mapped"
    tdb.block_size: 8192
    tdb.block_read_cache_size: 5000
    tdb.block_write_cache_size: 1000
    tdb.node2nodeid_cache_size: 200000
    tdb.nodeid2node_cache_size: 750000
    tdb.node_miss_cache_size: 1000
    tdb.nodetable: "nodes"
    tdb.triple_index_primary: "SPO"
    tdb.triple_indexes:
      - "SPO"
      - "POS"
      - "OSP"
    tdb.quad_index_primary: "GSPO"
    tdb.quad_indexes:
      - "GSPO"
      - "GPOS"
      - "GOSP"
      - "POSG"
      - "OSPG"
      - "SPOG"
    tdb.prefixtable: "prefixes"
    tdb.prefix_index_primary: "GPU"
    tdb.prefix_indexes:
      - "GPU"
  # Path of the transaction log
  transactionLogPath: "data/log"
  bulkTransactions: true
  elasticSearch:
    settings:
      # Map of hosts and ports. The host could also be an IP Address
      hostToPortMapping:
        "127.0.0.1": 9300
      # Name of the Cluster. Defaults to "elasticsearch". Set to "docker-cluster" for a dockerized ES setup.
      clusterName: "docker-cluster"
      # Number of shards. Defaults to 1
      shards: 1
      # Number of replicas. Defaults to 1
      replicas: 1
    advancedSettings:
auth:
  authServerUrl: http://localhost:5100/auth/
  realm: fairspace
  clientId: workspace-client
  enableBasicAuth: true
  superAdminUser: organisation-admin
webDAV:
  # Path of the WebDAV's local blob store
  blobStorePath: "data/blobs"
mail:
  mail.from: info@fairspace.com
  mail.user: user
  mail.password: password
  mail.transport.protocol: smtp
  mail.smtp.auth: true
  mail.smtp.host: host
  mail.smtp.port: 587
  mail.smtp.starttls.enable: true
services:
  jupyterhub: https://jupyter.org/hub#
  cbioportal: https://www.cbioportal.org
  "test username": http://google.com?q=${username}
features:
#  - MetadataEditing
search:
  pageRequestTimeout: 10000
  countRequestTimeout: 60000
  facets:
    - name: tumorTopography
      title: Tumor Topography
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?topography
        WHERE {
           ?topography a curie:Topography .
           FILTER EXISTS { ?sample curie:topography ?topography ; a curie:TumorPathologyEvent . }
        }
    - name: sampleTopography
      title: Sample Topography
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?topography
        WHERE {
           ?topography a curie:Topography .
           FILTER EXISTS { ?sample curie:topography ?topography ; a curie:BiologicalSample . }
        }
    - name: sampleNature
      title: Sample Nature
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?nature
        WHERE {
           ?nature a curie:SampleNature .
           FILTER EXISTS { ?x curie:isOfNature ?nature }
        }
    - name: sampleOrigin
      title: Sample Origin
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?t
        WHERE {
           ?t a curie:SampleOrigin .
           FILTER EXISTS { ?x curie:hasOrigin ?t }
        }
    - name: tumorCellularity
      title: Tumor Cellularity
      type: number
      min: 0
      max: 100
    - name: eventType
      title: Event Type
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?t
        WHERE {
           ?t a curie:EventType .
           FILTER EXISTS { ?x curie:eventType ?t }
        }
    - name: morphology
      title: Morphology
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?morphology
        WHERE {
           ?morphology a curie:TumorMorphology .
           FILTER EXISTS { ?x curie:tumorMorphology ?morphology }
        }
    - name: laterality
      title: Laterality
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?laterality
        WHERE {
           ?laterality a curie:TumorLaterality .
           FILTER EXISTS { ?x curie:tumorLaterality ?laterality }
        }
    - name: tumorGradeType
      title: Tumor Grade Type
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?tgt
        WHERE {
           ?tgt a curie:TumorGradeType.
           FILTER EXISTS { ?x curie:tumorGradeType ?tgt }
        }
    - name: tumorGradeValue
      title: Tumor Grade Value
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?tgv
        WHERE {
           ?tgv a curie:TumorGradeValue.
           FILTER EXISTS { ?x curie:tumorGradeValue ?tgv }
        }
    - name: tnmType
      title: TNM Type
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?t
        WHERE {
           ?t a curie:TnmType.
           FILTER EXISTS { ?x curie:tnmType ?t }
        }
    - name: tnmT
      title: The primary tumor size
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?t
        WHERE {
           ?t a curie:TnmT.
           FILTER EXISTS { ?x curie:tnmT ?t }
        }
    - name: tnmN
      title: The regional lymph nodes
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?t
        WHERE {
           ?t a curie:TnmN.
           FILTER EXISTS { ?x curie:tnmN ?t }
        }
    - name: tnmM
      title: Distant metastasis
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?t
        WHERE {
           ?t a curie:TnmM.
           FILTER EXISTS { ?x curie:tnmM ?t }
        }
    - name: ageAtDiagnosis
      title: Age at Diagnosis
      type: number
      min: 0
      max: 150
    - name: species
      title: Species
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?t
        WHERE {
           ?t a curie:Species.
           FILTER EXISTS { ?x curie:isOfSpecies ?t }
        }
    - name: gender
      title: Gender
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?g
        WHERE {
           ?g a curie:Gender .
           FILTER EXISTS { ?x curie:isOfGender ?g }
        }
    - name: ageAtLastNews
      title: Age at Last News
      type: number
      min: 0
      max: 150
    - name: ageAtDeath
      title: Age at Death
      type: number
      min: 0
      max: 150
    - name: analysisType
      title: Type of analysis
      type: id
      query: |
        PREFIX curie: <https://institut-curie.org/ontology#>
        SELECT ?analysis
        WHERE {
           ?analysis a curie:AnalysisType .
           FILTER EXISTS { ?x curie:analysisType ?analysis }
        }
    - name: location
      title: Collection
      type: id
      query: |
        PREFIX fs: <http://fairspace.io/ontology#>

        SELECT ?collection
        WHERE {
          ?collection a fs:Collection ;
          FILTER NOT EXISTS { ?collection fs:dateDeleted ?anyDateDeleted }
        }
  views:
    - name: samples
      title: Samples
      columns:
        - name: sample
          title: Sample
          type: id
        - name: sampleTopography
          title: Sample Topography
          type: id
        - name: sampleNature
          title: Sample Nature
          type: id
        - name: sampleOrigin
          title: Sample Origin
          type: id
        - name: tumorCellularity
          title: Tumor Cellularity
          type: number
        - name: event
          title: Tumor Pathology Event
          type: id
        - name: tumorTopography
          title: Tumor Topography
          type: id
        - name: eventType
          title: Event Type
          type: id
        - name: morphology
          title: Morphology
          type: id
        - name: laterality
          title: Laterality
          type: id
        - name: tumorGradeType
          title: Tumor Grade Type
          type: id
        - name: tumorGradeValue
          title: Tumor Grade Value
          type: id
        - name: tnmType
          title: TNM Type
          type: id
        - name: tnmT
          title: The primary tumor size
          type: id
        - name: tnmN
          title: The regional lymph nodes
          type: id
        - name: tnmM
          title: Distant metastasis
          type: id
        - name: ageAtDiagnosis
          title: Age at Diagnosis
          type: number
        - name: subject
          title: Subject
          type: id
        - name: species
          title: Species
          type: id
        - name: gender
          title: Gender
          type: id
        - name: ageAtLastNews
          title: Age at Last News
          type: number
        - name: ageAtDeath
          title: Age at Death
          type: number
        - name: analysisTypes
          title: AnalysisTypes
          type: text
      query: |
        PREFIX rdfs:  <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX curie: <https://institut-curie.org/ontology#>
        PREFIX fs:    <http://fairspace.io/ontology#>

        <#if fetch>
        SELECT ?sample ?sampleTopography ?sampleNature ?sampleOrigin ?tumorCellularity ?event ?tumorTopography ?morphology ?eventType
          ?laterality ?tumorGradeType ?tumorGradeValue ?tnmType ?tnmT ?tnmN ?tnmM ?ageAtDiagnosis ?subject ?gender
          ?species ?ageAtLastNews ?ageAtDeath ?analysisTypes
        <#else>
        SELECT ?sample
        </#if>
        WHERE {
          <#if fetch>
          { SELECT ?sample (GROUP_CONCAT(DISTINCT(?at); SEPARATOR = ", ") AS ?analysisTypes)
            WHERE {
              VALUES ?sample { ${iris} }
              OPTIONAL { ?sample (^curie:sample)/curie:analysisType/rdfs:label ?at }
            } GROUP BY ?sample
          }
          <#elseif location?? || analysisType??>
          {
            SELECT DISTINCT ?smpl WHERE {
               <#if location??>  ?file (fs:belongsTo)* ?location . ${location} </#if>
               FILTER NOT EXISTS { ?file fs:dateDeleted ?any }
               ?file curie:sample ?smpl .
               <#if analysisType??> ?file curie:analysisType ?analysisType . ${analysisType}</#if>
            }
          }
          BIND(?smpl AS ?sample)
          </#if>

          <#if fetch || sampleTopography??> OPTIONAL {?sample curie:topography ?sampleTopography } ${sampleTopography!} </#if>
          <#if fetch || sampleNature??>     OPTIONAL {?sample curie:isOfNature ?sampleNature } ${sampleNature!} </#if>
          <#if fetch || sampleOrigin??>     OPTIONAL {?sample curie:hasOrigin ?sampleOrigin } ${sampleOrigin!} </#if>
          <#if fetch || tumorCellularity??> OPTIONAL {?sample curie:tumorCellularity ?tumorCellularity } ${tumorCellularity!} </#if>

          <#if fetch || species?? || gender?? || ageAtLastNews?? || ageAtDeath??>
            ?sample curie:subject ?subject .
            <#if fetch || species??>OPTIONAL {?subject curie:isOfSpecies ?species} ${species!}</#if>
            <#if fetch || gender??> OPTIONAL {?subject curie:isOfGender ?gender} ${gender!}</#if>
            <#if fetch || ageAtLastNews??>OPTIONAL {?subject curie:ageAtLastNews ?ageAtLastNews} ${ageAtLastNews!}</#if>
            <#if fetch || ageAtDeath??>OPTIONAL {?subject curie:ageAtDeath ?ageAtDeath} ${ageAtDeath!}</#if>
         </#if>

         <#assign has_event_filter = morphology?? || tumorTopography?? || eventType?? || laterality?? || ageAtDiagnosis?? || tumorGradeType?? || tumorGradeValue?? || tnmType?? || tnmT?? || tnmN?? || tnmM??>
         <#if fetch || has_event_filter>
            <#if !has_event_filter>OPTIONAL {</#if>
              ?sample curie:diagnosis ?event .

              <#if fetch || morphology??>      OPTIONAL { ?event curie:tumorMorphology ?morphology } ${morphology!} </#if>
              <#if fetch || eventType??>       OPTIONAL { ?event curie:eventType ?eventType } ${eventType!} </#if>
              <#if fetch || tumorTopography??> OPTIONAL { ?event curie:topography ?tumorTopography } ${tumorTopography!} </#if>
              <#if fetch || laterality??>      OPTIONAL { ?event curie:tumorLaterality ?laterality } ${laterality!} </#if>
              <#if fetch || ageAtDiagnosis??>  OPTIONAL { ?event curie:ageAtDiagnosis ?ageAtDiagnosis } ${ageAtDiagnosis!} </#if>
              <#if fetch || tumorGradeType??>  OPTIONAL { ?event curie:tumorGradeType ?tumorGradeType } ${tumorGradeType!} </#if>
              <#if fetch || tumorGradeValue??> OPTIONAL { ?event curie:tumorGradeValue ?tumorGradeValue } ${tumorGradeValue!} </#if>
              <#if fetch || tnmType??>         OPTIONAL { ?event curie:tnmType ?tnmType } ${tnmType!} </#if>
              <#if fetch || tnmT??>            OPTIONAL { ?event curie:tnmT ?tnmT } ${tnmT!} </#if>
              <#if fetch || tnmN??>            OPTIONAL { ?event curie:tnmN ?tnmN } ${tnmN!} </#if>
              <#if fetch || tnmM??>            OPTIONAL { ?event curie:tnmM ?tnmM } ${tnmM!} </#if>
            <#if !has_event_filter>}</#if>
          </#if>

          <#if !fetch>
            ?sample a curie:BiologicalSample .
            FILTER NOT EXISTS { ?sample fs:dateDeleted ?anyDateDeleted }
          </#if>
        }
    - name: events
      title: Tumor Pathology Events
      columns:
        - name: event
          title: Tumor Pathology Event
          type: id
        - name: Event Type
          title: eventType
          type: id
        - name: tumorTopography
          title: Tumor Topography
          type: id
        - name: sampleTopography
          title: Sample Topography
          type: id
        - name: morphology
          title: Morphology
          type: id
        - name: laterality
          title: Laterality
          type: id
        - name: ageAtDiagnosis
          title: Age at Diagnosis
          type: number
        - name: tumorGradeType
          title: Tumor Grade Type
          type: id
        - name: tumorGradeValue
          title: Tumor Grade Value
          type: id
        - name: tnmType
          title: TNM Type
          type: id
        - name: tnmT
          title: The primary tumor size
          type: id
        - name: tnmN
          title: The regional lymph nodes
          type: id
        - name: tnmM
          title: Distant metastasis
          type: id
        - name: subject
          title: Subject
          type: id
        - name: species
          title: Species
          type: id
        - name: gender
          title: Gender
          type: id
        - name: ageAtLastNews
          title: Age at Last News
          type: number
        - name: ageAtDeath
          title: Age at Death
          type: number
      query: |
        PREFIX rdfs:  <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX curie: <https://institut-curie.org/ontology#>
        PREFIX fs:    <http://fairspace.io/ontology#>

        <#if fetch>
        SELECT ?event ?eventType ?morphology ?topography ?laterality ?tumorGradeType ?tumorGradeValue ?tnmType ?tnmT
               ?tnmN ?tnmM ?ageAtDiagnosis ?subject ?gender ?species ?ageAtLastNews ?ageAtDeath
        <#else>
        SELECT ?event
        </#if>
        WHERE {
          <#if fetch>
          VALUES ?event { ${iris} }
          <#elseif location?? || analysisType??>
          {
            SELECT DISTINCT ?e WHERE {
               <#if location??> ?file (fs:belongsTo)* ?location . ${location} </#if>
               FILTER NOT EXISTS { ?file fs:dateDeleted ?any }
               ?file curie:aboutEvent ?e .
               <#if analysisType??> ?file curie:analysisType ?analysisType . ${analysisType}</#if>
            }
          }
          BIND(?e AS ?event)
          </#if>

          <#if fetch || morphology??>      OPTIONAL { ?event curie:tumorMorphology ?morphology } ${morphology!} </#if>
          <#if fetch || eventType??>       OPTIONAL { ?event curie:eventType ?eventType } ${eventType!} </#if>
          <#if fetch || tumorTopography??> OPTIONAL { ?event curie:topography ?tumorTopography } ${tumorTopography!} </#if>
          <#if fetch || laterality??>      OPTIONAL { ?event curie:tumorLaterality ?laterality } ${laterality!} </#if>
          <#if fetch || ageAtDiagnosis??>  OPTIONAL { ?event curie:ageAtDiagnosis ?ageAtDiagnosis } ${ageAtDiagnosis!} </#if>
          <#if fetch || tumorGradeType??>  OPTIONAL { ?event curie:tumorGradeType ?tumorGradeType } ${tumorGradeType!} </#if>
          <#if fetch || tumorGradeValue??> OPTIONAL { ?event curie:tumorGradeValue ?tumorGradeValue } ${tumorGradeValue!} </#if>
          <#if fetch || tnmType??>         OPTIONAL { ?event curie:tnmType ?tnmType } ${tnmType!} </#if>
          <#if fetch || tnmT??>            OPTIONAL { ?event curie:tnmT ?tnmT } ${tnmT!} </#if>
          <#if fetch || tnmN??>            OPTIONAL { ?event curie:tnmN ?tnmN } ${tnmN!} </#if>
          <#if fetch || tnmM??>            OPTIONAL { ?event curie:tnmM ?tnmM } ${tnmM!} </#if>

          ?event a curie:TumorPathologyEvent .

          <#if fetch || species?? || gender?? || ageAtLastNews?? || ageAtDeath??>
             ?event curie:eventSubject ?subject .
             <#if fetch || species??>OPTIONAL {?subject curie:isOfSpecies ?species} ${species!}</#if>
             <#if fetch || gender??> OPTIONAL {?subject curie:isOfGender ?gender} ${gender!}</#if>
             <#if fetch || ageAtLastNews??>OPTIONAL {?subject curie:ageAtLastNews ?ageAtLastNews} ${ageAtLastNews!}</#if>
             <#if fetch || ageAtDeath??>OPTIONAL {?subject curie:ageAtDeath ?ageAtDeath} ${ageAtDeath!}</#if>
          </#if>

          <#if sampleTopography?? || sampleNature?? || sampleOrigin?? || tumorCellularity??>
          FILTER EXISTS {
            ?sample curie:diagnosis ?event .
            <#if sampleTopography??> ?sample curie:topography ?sampleTopography . ${sampleTopography} </#if>
            <#if sampleNature??>     ?sample curie:isOfNature ?sampleNature . ${sampleNature} </#if>
            <#if sampleOrigin??>     ?sample curie:hasOrigin ?sampleOrigin . ${sampleOrigin} </#if>
            <#if tumorCellularity??> ?sample curie:tumorCellularity ?tumorCellularity . ${tumorCellularity} </#if>
          }
          </#if>

          FILTER NOT EXISTS { ?event fs:dateDeleted ?anyDateDeleted }
        }
    - name: subjects
      title: Subjects
      columns:
        - name: subject
          title: Subject
          type: id
        - name: species
          title: Species
          type: id
        - name: gender
          title: Gender
          type: id
        - name: ageAtLastNews
          title: Age at Last News
          type: number
        - name: ageAtDeath
          title: Age at Death
          type: number
      query: |
        PREFIX rdfs:  <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX curie: <https://institut-curie.org/ontology#>
        PREFIX fs:    <http://fairspace.io/ontology#>

        <#if fetch>
        SELECT ?subject ?species ?gender ?ageAtLastNews ?ageAtDeath
        <#else>
        SELECT ?subject
        </#if>
        WHERE {
          <#if fetch>
          VALUES ?subject { ${iris} }
          <#elseif location?? || analysisType??>
          {
            SELECT DISTINCT ?s WHERE {
               <#if location??> ?file (fs:belongsTo)* ?location . ${location} </#if>
               FILTER NOT EXISTS { ?file fs:dateDeleted ?any }
               ?file curie:aboutSubject ?s .
               <#if analysisType??> ?file curie:analysisType ?analysisType . ${analysisType}</#if>
            }
          }
          BIND(?s AS ?subject)
          </#if>

          ?subject a curie:Subject .

          <#if sampleTopography?? || sampleNature?? || sampleOrigin?? || tumorCellularity??>
          FILTER EXISTS {
            ?sample curie:subject ?subject .
            <#if sampleTopography??> ?sample curie:topography ?sampleTopography . ${sampleTopography} </#if>
            <#if sampleNature??>     ?sample curie:isOfNature ?sampleNature . ${sampleNature} </#if>
            <#if sampleOrigin??>     ?sample curie:hasOrigin ?sampleOrigin . ${sampleOrigin} </#if>
            <#if tumorCellularity??> ?sample curie:tumorCellularity ?tumorCellularity . ${tumorCellularity} </#if>
          }
          </#if>

          <#if morphology?? || eventType?? || tumorTopography?? || laterality?? || ageAtDiagnosis?? || tumorGradeType?? || tumorGradeValue?? || tnmType?? || tnmT?? || tnmN?? || tnmTM??>
          FILTER EXISTS {
            ?event curie:eventSubject ?subject .
            <#if morphology??>      ?event curie:tumorMorphology ?morphology . ${morphology} </#if>
            <#if eventType??>       ?event curie:eventType ?eventType . ${eventType} </#if>
            <#if tumorTopography??> ?event curie:topography ?tumorTopography . ${tumorTopography} </#if>
            <#if laterality??>      ?event curie:tumorLaterality ?laterality . ${laterality} </#if>
            <#if ageAtDiagnosis??>  ?event curie:ageAtDiagnosis ?ageAtDiagnosis . ${ageAtDiagnosis} </#if>
            <#if tumorGradeType??>  ?event curie:tumorGradeType ?tumorGradeType . ${tumorGradeType} </#if>
            <#if tumorGradeValue??> ?event curie:tumorGradeValue ?tumorGradeValue . ${tumorGradeValue} </#if>
            <#if tnmType??>         ?event curie:tnmType ?tnmType . ${tnmType} </#if>
            <#if tnmT??>            ?event curie:tnmT ?tnmT . ${tnmT} </#if>
            <#if tnmN??>            ?event curie:tnmN ?tnmN . ${tnmN} </#if>
            <#if tnmM??>            ?event curie:tnmM ?tnmM . ${tnmM} </#if>
          }
          </#if>

          <#if fetch || species??>
          OPTIONAL { ?subject curie:isOfSpecies ?species } ${species!}
          </#if>
          <#if fetch || gender??>
          OPTIONAL { ?subject curie:isOfGender ?gender } ${gender!}
          </#if>
          <#if fetch || ageAtLastNews??>
          OPTIONAL { ?subject curie:ageAtLastNews ?ageAtLastNews } ${ageAtLastNews!}
          </#if>
          <#if fetch || ageAtDeath??>
          OPTIONAL { ?subject curie:ageAtDeath ?ageAtDeath } ${ageAtDeath!}
          </#if>

          FILTER NOT EXISTS { ?subject fs:dateDeleted ?anyDateDeleted }
        }
    - name: files
      title: Files
      columns:
        - name: file
          title: File
          type: id
        - name: kind
          title: Kind
          type: text
        - name: collection
          title: Collection
          type: id
        - name: workspace
          title: Workspace
          type: id
        - name: analysisType
          title: Analysis Type
          type: id
        - name: dateCreated
          title: Created
          type: date
        - name: dateModified
          title: Modified
          type: date
      query: |
        PREFIX rdfs:  <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX curie: <https://institut-curie.org/ontology#>
        PREFIX fs:    <http://fairspace.io/ontology#>

        <#if fetch>
        SELECT ?file ?kind ?collection ?workspace ?dateCreated ?dateModified
        <#else>
        SELECT ?file
        </#if>
        WHERE {
          <#if fetch>
          VALUES ?file { ${iris} }
          <#elseif location??>
          {
            SELECT ?f WHERE {
              ?f (fs:belongsTo)* ?location . ${location}
              FILTER NOT EXISTS { ?f fs:dateDeleted ?any}
            }
          }
          BIND(?f AS ?file)
          </#if>

          ?file a ?type .
          <#if !fetch>FILTER ((?type = fs:File) || (?type = fs:Directory) || (?type = fs:Collection))</#if>

          <#if fetch || analysisType??> OPTIONAL { ?file curie:analysisType ?analysisType } ${analysisType!}</#if>

          <#if fetch>
            BIND(IF(?type = fs:File, "File", IF(?type = fs:Directory, "Directory", IF(?type = fs:Collection, "Collection", "Workspace"))) AS ?kind)
            ?file (fs:belongsTo)* ?collection . ?collection fs:ownedBy ?workspace .
            OPTIONAL {?file fs:dateCreated ?dateCreated}
            OPTIONAL {?file fs:dateModified ?dateModified}
          <#else>
            <#if sampleTopography?? || sampleNature?? || sampleOrigin?? || tumorCellularity??>
              FILTER EXISTS {
                ?file curie:sample ?sample .
                <#if sampleTopography??> ?sample curie:topography ?sampleTopography . ${sampleTopography} </#if>
                <#if sampleNature??>     ?sample curie:isOfNature ?sampleNature . ${sampleNature} </#if>
                <#if sampleOrigin??>     ?sample curie:hasOrigin ?sampleOrigin . ${sampleOrigin} </#if>
                <#if tumorCellularity??> ?sample curie:tumorCellularity ?tumorCellularity . ${tumorCellularity} </#if>


                <#if morphology?? || eventType?? || tumorTopography?? || laterality?? || ageAtDiagnosis?? || tumorGradeType?? || tumorGradeValue?? || tnmType?? || tnmT?? || tnmN?? || tnmTM??>
                  ?sample curie:diagnosis ?event .
                  <#if morphology??>      ?event curie:tumorMorphology ?morphology . ${morphology} </#if>
                  <#if eventType??>       ?event curie:eventType ?eventType . ${eventType} </#if>
                  <#if tumorTopography??> ?event curie:topography ?tumorTopography . ${tumorTopography} </#if>
                  <#if laterality??>      ?event curie:tumorLaterality ?laterality . ${laterality} </#if>
                  <#if ageAtDiagnosis??>  ?event curie:ageAtDiagnosis ?ageAtDiagnosis . ${ageAtDiagnosis} </#if>
                  <#if tumorGradeType??>  ?event curie:tumorGradeType ?tumorGradeType . ${tumorGradeType} </#if>
                  <#if tumorGradeValue??> ?event curie:tumorGradeValue ?tumorGradeValue . ${tumorGradeValue} </#if>
                  <#if tnmType??>         ?event curie:tnmType ?tnmType . ${tnmType} </#if>
                  <#if tnmT??>            ?event curie:tnmT ?tnmT . ${tnmT} </#if>
                  <#if tnmN??>            ?event curie:tnmN ?tnmN . ${tnmN} </#if>
                  <#if tnmM??>            ?event curie:tnmM ?tnmM . ${tnmM} </#if>
                </#if>

                <#if species?? || gender?? || ageAtLastNews?? || ageAtDeath??>
                   ?sample curie:subject ?subject .
                   <#if species??> ?subject curie:isOfSpecies ?species . ${species}</#if>
                   <#if gender??> ?subject curie:isOfGender ?gender . ${gender}</#if>
                   <#if ageAtLastNews??> ?subject curie:ageAtLastNews ?ageAtLastNews . ${ageAtLastNews}</#if>
                   <#if ageAtDeath??> ?subject curie:ageAtDeath ?ageAtDeath . ${ageAtDeath}</#if>
                </#if>
               }
            <#elseif morphology?? || eventType?? || tumorTopography?? || laterality?? || ageAtDiagnosis?? || tumorGradeType?? || tumorGradeValue?? || tnmType?? || tnmT?? || tnmN?? || tnmTM??>
              FILTER EXISTS {
                ?file curie:aboutEvent ?event .
                <#if morphology??>      ?event curie:tumorMorphology ?morphology . ${morphology} </#if>
                <#if eventType??>       ?event curie:eventType ?eventType . ${eventType} </#if>
                <#if tumorTopography??> ?event curie:topography ?tumorTopography . ${tumorTopography} </#if>
                <#if laterality??>      ?event curie:tumorLaterality ?laterality . ${laterality} </#if>
                <#if ageAtDiagnosis??>  ?event curie:ageAtDiagnosis ?ageAtDiagnosis . ${ageAtDiagnosis} </#if>
                <#if tumorGradeType??>  ?event curie:tumorGradeType ?tumorGradeType . ${tumorGradeType} </#if>
                <#if tumorGradeValue??> ?event curie:tumorGradeValue ?tumorGradeValue . ${tumorGradeValue} </#if>
                <#if tnmType??>         ?event curie:tnmType ?tnmType . ${tnmType} </#if>
                <#if tnmT??>            ?event curie:tnmT ?tnmT . ${tnmT} </#if>
                <#if tnmN??>            ?event curie:tnmN ?tnmN . ${tnmN} </#if>
                <#if tnmM??>            ?event curie:tnmM ?tnmM . ${tnmM} </#if>

                <#if species?? || gender?? || ageAtLastNews?? || ageAtDeath??>
                   ?event curie:eventSubject ?subject .
                   <#if species??> ?subject curie:isOfSpecies ?species . ${species}</#if>
                   <#if gender??> ?subject curie:isOfGender ?gender . ${gender}</#if>
                   <#if ageAtLastNews??> ?subject curie:ageAtLastNews ?ageAtLastNews . ${ageAtLastNews}</#if>
                   <#if ageAtDeath??> ?subject curie:ageAtDeath ?ageAtDeath . ${ageAtDeath}</#if>
                </#if>
              }
            <#elseif species?? || gender?? || ageAtLastNews?? || ageAtDeath??>
              FILTER EXISTS {
                ?file curie:aboutSubject ?subject .
                <#if species??> ?subject curie:isOfSpecies ?species . ${species}</#if>
                <#if gender??> ?subject curie:isOfGender ?gender . ${gender}</#if>
                <#if ageAtLastNews??> ?subject curie:ageAtLastNews ?ageAtLastNews . ${ageAtLastNews}</#if>
                <#if ageAtDeath??> ?subject curie:ageAtDeath ?ageAtDeath . ${ageAtDeath}</#if>
              }
            </#if>
          </#if>
        }